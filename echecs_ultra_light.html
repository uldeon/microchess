<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Échecs ultra-léger</title>
  <style>
    body {
      font-family: monospace;
      background: #fff;
      color: #000;
      text-align: center;
    }
    table {
      border-collapse: collapse;
      margin: auto;
    }
    td {
      width: 24px;
      height: 24px;
      border: 1px solid #000;
      text-align: center;
      vertical-align: middle;
      font-size: 16px;
    }
    .w { background: #eee; }
    .b { background: #aaa; }
  </style>
</head>
<body>
  <h1>Échecs ultra-léger</h1>
  <p>Difficulté : 
    <select id="difficulty">
      <option value="1">Facile</option>
      <option value="2">Normal</option>
      <option value="3">Difficile</option>
    </select>
  </p>
  <table id="board"></table>

  <script>
    const boardEl = document.getElementById("board");
    let board = [];
    let selected = null;

    const pieces = {
      r: "♜", n: "♞", b: "♝", q: "♛", k: "♚", p: "♟",
      R: "♖", N: "♘", B: "♗", Q: "♕", K: "♔", P: "♙"
    };

    function initialBoard() {
      return [
        ["r","n","b","q","k","b","n","r"],
        ["p","p","p","p","p","p","p","p"],
        [" "," "," "," "," "," "," "," "],
        [" "," "," "," "," "," "," "," "],
        [" "," "," "," "," "," "," "," "],
        [" "," "," "," "," "," "," "," "],
        ["P","P","P","P","P","P","P","P"],
        ["R","N","B","Q","K","B","N","R"]
      ];
    }

    function drawBoard() {
      boardEl.innerHTML = "";
      for (let y = 0; y < 8; y++) {
        const row = document.createElement("tr");
        for (let x = 0; x < 8; x++) {
          const cell = document.createElement("td");
          cell.className = (x + y) % 2 === 0 ? "w" : "b";
          cell.textContent = pieces[board[y][x]] || board[y][x];
          cell.onclick = () => clickCell(x, y);
          row.appendChild(cell);
        }
        boardEl.appendChild(row);
      }
    }

    function clickCell(x, y) {
      const piece = board[y][x];
      if (selected) {
        const [sx, sy] = selected;
        if (sx === x && sy === y) {
          selected = null; // annulation du déplacement si même case cliquée
          return;
        }
        board[y][x] = board[sy][sx];
        board[sy][sx] = " ";
        selected = null;
        drawBoard();
        setTimeout(aiMove, 100);
      } else if (/[PNBRQK]/.test(piece)) {
        selected = [x, y];
      }
    }

    function aiMove() {
      const difficulty = +document.getElementById("difficulty").value;
      let moves = [];
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          const p = board[y][x];
          if (/[pnbrqk]/.test(p)) {
            // IA très simpliste : déplacement de pions aléatoire
            let dirs = [[0, 1], [1, 1], [-1, 1]];
            dirs.forEach(d => {
              const nx = x + d[0], ny = y + d[1];
              if (ny < 8 && nx >= 0 && nx < 8 && /[PNBRQK ]/.test(board[ny][nx]))
                moves.push([[x, y], [nx, ny]]);
            });
          }
        }
      }
      if (moves.length > 0) {
        const move = moves[Math.floor(Math.random() * moves.length / difficulty)];
        const [[x1, y1], [x2, y2]] = move;
        board[y2][x2] = board[y1][x1];
        board[y1][x1] = " ";
        drawBoard();
      }
    }

    board = initialBoard();
    drawBoard();
  </script>
</body>
</html>
